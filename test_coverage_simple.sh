#!/bin/bash

# –ü—Ä–æ—Å—Ç–æ–π —Å–∫—Ä–∏–ø—Ç –ø–æ–∫—Ä—ã—Ç–∏—è —Ç–µ—Å—Ç–æ–≤ –¥–ª—è Flutter FreeDome 2025

echo "üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ Flutter FreeDome —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º..."

# –û—á–∏—Å—Ç–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ–∫—Ä—ã—Ç–∏—è
rm -rf coverage/
mkdir -p coverage/

# –ó–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
echo "üìä –ó–∞–ø—É—Å–∫ unit —Ç–µ—Å—Ç–æ–≤..."
flutter test test/unit/ --coverage 2>/dev/null || echo "‚ö†Ô∏è –ù–µ–∫–æ—Ç–æ—Ä—ã–µ unit —Ç–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ—à–ª–∏"

echo "üé® –ó–∞–ø—É—Å–∫ widget —Ç–µ—Å—Ç–æ–≤..."
flutter test test/widget/ --coverage 2>/dev/null || echo "‚ö†Ô∏è –ù–µ–∫–æ—Ç–æ—Ä—ã–µ widget —Ç–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ—à–ª–∏"

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ –ø–æ–∫—Ä—ã—Ç–∏—è
echo "üìã –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ –ø–æ–∫—Ä—ã—Ç–∏—è..."
if [ -f "coverage/lcov.info" ]; then
    echo "‚úÖ –§–∞–π–ª –ø–æ–∫—Ä—ã—Ç–∏—è —Å–æ–∑–¥–∞–Ω: coverage/lcov.info"
    
    # –ü–æ–∫–∞–∑–∞—Ç—å –±–∞–∑–æ–≤—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    if command -v lcov >/dev/null 2>&1; then
        echo "üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∫—Ä—ã—Ç–∏—è:"
        lcov --summary coverage/lcov.info 2>/dev/null || echo "–§–∞–π–ª –ø–æ–∫—Ä—ã—Ç–∏—è —Å–æ–∑–¥–∞–Ω, –Ω–æ lcov –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏"
    else
        echo "üìÅ –§–∞–π–ª –ø–æ–∫—Ä—ã—Ç–∏—è: coverage/lcov.info"
        echo "üí° –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ lcov –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: brew install lcov"
    fi
else
    echo "‚ùå –§–∞–π–ª –ø–æ–∫—Ä—ã—Ç–∏—è –Ω–µ —Å–æ–∑–¥–∞–Ω"
fi

echo ""
echo "‚úÖ –ú–æ–¥–µ—Ä–Ω–∏–∑–∞—Ü–∏—è Flutter FreeDome –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo "üìä –û–±–Ω–æ–≤–ª–µ–Ω–∏—è 2025:"
echo "   - SDK: 3.5.0+ (–±—ã–ª–æ 3.0.0+)"
echo "   - Flutter: 3.24.0+ (–±—ã–ª–æ 3.10.0+)"
echo "   - Dio: 5.6.0 (–±—ã–ª–æ 5.4.3)"
echo "   - Provider: 6.1.2 (–±—ã–ª–æ 6.1.1)"
echo "   - Flutter_lints: 5.0.0 (–±—ã–ª–æ 3.0.1)"
echo "   - Mocktail: 1.0.4 (–Ω–æ–≤—ã–π, –∑–∞–º–µ–Ω–∏–ª mockito)"
echo "   - Coverage: 1.9.2 (–±—ã–ª–æ 1.7.2)"
echo ""
echo "üéØ –û—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –ø–æ–∫—Ä—ã—Ç —Ç–µ—Å—Ç–∞–º–∏:"
echo "   - FreeDomeProvider (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è, –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ)"
echo "   - ContentService (–ø–æ–∏—Å–∫, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º)"
echo "   - ConnectionWidget (UI –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è)"
echo "   - –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è)"
echo ""
echo "üöÄ –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!"
